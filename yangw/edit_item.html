<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
		<link type="text/css" rel="stylesheet" href="fake_items.css" />
		<style type="text/css">
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js" type="text/javascript"></script>
		<script src="https://acuth.github.io/awac/awac.js" type="text/javascript"></script>
		<script src="https://storage.googleapis.com/code.getmdl.io/1.2.1/material.min.js" type="text/javascript"></script>
		<script src="fake_items.js" type="text/javascript"></script>
		<script src="edit.js" type="text/javascript"></script>
		<script type="text/javascript">
			var _awac = null;
			var _fitem = null;
			var _item_markdown = null;
			var _markdown = null;
			var _title = null;

			function startPage() {
				var styleUrl = 'https://code.getmdl.io/1.2.1/material.orange-indigo.min.css';
				_awac.startMdlPage('toplevel',styleUrl);
			}

			function onAction(action) {
			  if ('back' == action)
			    _awac.endPage();
			  else if ('edit:markdown' == action)
			    _awac.openPage('edit-item-markdown','edit_markdown.html',{'markdown':_markdown});
				else if ('edit:title' == action) {
					editItemTitle();
				}
				else
			    _awac.alert('action '+action+' NYI');
			}

			function newSpan(classes) {
			  var d = $(document.createElement('span'));
			  if (classes) d.addClass(classes);
			  return d;
			}

			function newDiv(classes) {
			  var d = $(document.createElement('div'));
			  if (classes) d.addClass(classes);
			  return d;
			}

			function getActionSpan(name,action) {
			    var span = newSpan('edit-control-span');
          span.html('<i class="material-icons">'+action+'</i>');
          span.on('click',function(){onAction(action+':'+name);});
          return span;
			}

			function appendEditControls(c) {
			  var html = '<span class="edit-control-span"><i class="material-icons">delete</i></span>' +
			    '<span class="edit-control-span"><i class="material-icons">edit</i></span>';
			  c.html(html);
			}

			function renderItem(fitem) {
			   console.log('edit_item.renderItem()');
			   console.log(JSON.stringify(fitem));
				  var iname = fitem.getMDIcon();
				  console.log('iname='+iname);
				  var a = fitem.getUserHTML(null,fitem.json.author,true);

					_item_markdown = fitem.json.markdown;
					_markdown = _item_markdown;
					_title = fitem.json.name_attr;

					showItemTitle(_title);

			    var typesDiv = $('#item-types-div');
			    typesDiv.html('');
					t = newDiv('padded-container').css('display','flex').html('<div class="item-type"><i class="material-icons">'+iname+'</i></div>');
					getEditControl('edit','edit:type').appendTo(t);
					t.appendTo(typesDiv);

			    showItemMarkdown(_markdown,_item_markdown);
			}

			function onPageClose(tag,ok,result) {
				if (tag == 'edit-item-markdown') {
						if (ok && result) {
							_markdown = result.markdown;
							showItemMarkdown(_markdown,_item_markdown);
						}
				}
				else {
					console.log('got result from '+tag+' ok='+ok+' result='+result);
				}
			}

			$(document).ready(function() {
			  _awac = new Awac('_awac');
			  var initp = _awac.getInitParam();
			  var fitem = new FItem(initp.json,true);
			  console.log('got fitem='+fitem);

  		  _awac.setOnPageClose(onPageClose);
			  _awac.setOnAction(onAction);
			  _awac.setOnBackPressed(function() { onAction('back'); });
			  _awac.setHomeItem({'label':'Back','icon':'close','action':'back'});
			  _awac.addActionBarItem({'label':'SAVE','action':'save'});

			  renderItem(fitem);

				startPage();
				_fitem = fitem;
			});
			</script>
	</head>
	<body>
    <div id="toplevel" class="mdl-layout mdl-js-layout">
      <div id="item-title-div">-item-title-goes-here-</div>
      <div id="item-types-div">-item-types-go-here-</div>
      <div id="item-markdown-div">-item-markdown-goes-here-</div>
	  </div> <!-- toplevel -->
	</body>
</html>
