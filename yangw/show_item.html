<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" />
		<link type="text/css" rel="stylesheet" href="fake_items.css" />
		<style type="text/css">

		@media screen and (min-width: 961px) {
div#show-item {
	border: solid 0px red;
}

div#show-item-content {
	border: solid 0px green;
	width: 60%;
	float: left;
}

div#show-item-content div.padded-container {
	padding: 40px;
}

div#show-item-markdown p {
	line-height: 20px;
}

div#show-item-lists {
	border: solid 0px blue;
	width: 40%;
	margin-left: 60%;
}
}

.box {
	width: 100px;
	height: 100px;
	display: block;
	background-color: #5045aF;
	-webkit-transition: -webkit-transform: 0.35s;
	transition: transform 0.35s;
}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js" type="text/javascript"></script>
		<script src="https://acuth.github.io/awac/awac.js" type="text/javascript"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js" type="text/javascript"></script>
		<!--script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.3.0/showdown.min.js" type="text/javascript"></script-->
		<script src="https://storage.googleapis.com/code.getmdl.io/1.3.0/material.min.js" type="text/javascript"></script>
		<script src="awac_ext.js" type="text/javascript"></script>
		<script src="fake_attrs.js" type="text/javascript"></script>
		<script src="fake_item_types.js" type="text/javascript"></script>
		<script src="fake_items.js" type="text/javascript"></script>
		<script type="text/javascript">
			var _awac = null;
			var _itemId = null;
			var _fitem = null;

			function startPage() {
				var styleUrl = 'https://code.getmdl.io/1.3.0/material.orange-indigo.min.css';
				_awac.startMdlPage('toplevel',styleUrl);
				setTimeout(function(){console.log('MDL component handler update DOM');componentHandler.upgradeDom();},10000);
			}

			var _left = true;
			function doTest() {
				if (false) {
					var ta = $('#test-area');
				var w = ta.width() - 100;
				var box = document.getElementById('my-box');
				console.log('got '+box+' ta.width='+w);
 				if (_left) {
					_left = false;
					box.style.transform = 'translate3d('+w+'px,0,0)';
				} else {
					_left = true;
					box.style.transform = 'translate3d(0px,0,0)';
				}
    		//box.style.transform += 'translateX(200px)';
				return;
			}


		   var html ='<span class="mdl-chip mdl-chip--deletable">'+
    	//'<span class="mdl-chip__contact mdl-color--gray mdl-color-text--dark-orange"><i style="color:teal;font-size:18px;line-height:32px;" class="material-icons">label_outline</i></span>'+
    					'<span class="mdl-chip__text">Contact Chip</span>'+
							'<a href="#" class="mdl-chip__action mdl-color-text--teal"><i class="material-icons">label_outline</i></a>'+
							'</span>';

		    html += '<hr/>Date <input type="date"/><br/>Time <input type="time"/>';

				html = '<table class="mdl-data-table mdl-js-data-table">';
				html += '<tbody>';
				html += '<tr><td class="item-row mdl-data-table__cell--non-numeric">Acrylic (Transparent)</td><td class="item-row">25</td><td class="item-row">$2.90</td></tr>';
				html += '<tr><td class="item-row mdl-data-table__cell--non-numeric">Acrylic (Transparent) but a very long text what do I do with it</td><td>25</td><td>$2.90</td></tr>';
				html += '<tr><td class="item-row mdl-data-table__cell--non-numeric">Acrylic (Transparent)</td><td>25</td><td>$2.90</td></tr>';
				html += '</tbody>';
				html += '</table>';

				document.getElementById('test-area').innerHTML = html;
				componentHandler.upgradeDom();
			}

			function onAction(action) {
				console.log('onAction('+action+')');
			  if ('signout' == action) {
			    _awac.signOut();
			    _awac.replacePage('signin','app_login.html',null,false);
			  }
			  else if ('back' == action)
			    showPrevPage();
				else if ('test' == action)
					doTest();
			  else if ('recent' == action)
			    showRecentItems();
			  else if ('comments' == action)
			    showCommentItems();
			  else if ('history' == action)
			    showHistory();
			  else if ('+comment' == action)
			    doAddComment();
			  else if ('+child' == action)
			    doAddChildPage();
				else if ('+task' == action)
					doAddChildTask();
			  else if (action.indexOf('new-tag:') == 0)
			    doNewTag(action.substring(8));
			  else if (action.indexOf('new-page:') == 0)
			    doNewPage(action.substring(9));
				else if (action.indexOf('toggle-attr:') == 0)
					doToggleAttr(action.substring(12));
			  else if ('edit' == action)
			    doEditItem();
			  else if ('add' == action)
			    displayAddList();
			  else
			    _awac.alert('action '+action+' NYI');
			}

			function onPageClose(tag,ok,result) {
			  if (ok && result) {
  			  if (tag == 'add-comment') {
						if (result.markdown)
	  		    	FItem.addComment(_itemId,result.markdown,refreshCommentList);
						else
							console.log('no markdown so did not create comment item');
			    }
					else if (tag == 'edit-item') {
						if (result && result.updated) {
							FItem.get(_itemId,function(fitem) {
								renderItem(fitem);
								_fitem = fitem;
							});
						}
					}
			    else if (tag == 'edit-child-markdown') {
	  		    FItem.addChildPage(_itemId,result.name_attr,result.markdown,showNextPage);
			    }
					else if (tag == 'edit-task-title') {
						FItem.addChildTask(_itemId,result.name_attr,null,newChildTask);
					}
			    else if (tag == 'new-tag-markdown') {
	  		    FItem.addTag(result.name_attr,result.markdown,showNextPage);
			    }
			    else if (tag == 'new-page') {
	  		    FItem.addPage(result.item_id,result.name_attr,result.markdown,showNextPage);
			    }
			    else if (tag == 'recent') {
			      console.log('show page '+result);
			      //showNextPage(item_id);
			    }
			    else {
			      _awac.alert('page with tag '+tag+' has closed');
			    }
			  }
			}

			function displayAddList() {
			  // cannot add child posts to comments
			  // cannot add child items to users unless you are the user

			  var labels = ['new page','new tag','add comment','add child page','add child task','add next page'];
			  var actions = ['new-page:','new-tag:','+comment','+child','+task','+next'];
			  var items = new Array();
			  for (var i=0;i<labels.length;i++) {
			      var item = new Object();
			      item.label = labels[i];
			      item.action = actions[i];
			      items[i] = item;
		    }
			  _awac.list(items,function(n) {
			    if (n != -1) {
			        var newAction = items[n].action;
			        if (newAction == '+comment' || newAction == '+child' || newAction == '+task' || newAction.indexOf('new-page:') == 0 || newAction.indexOf('new-tag:') == 0)
			          onAction(newAction);
			        else
			          _awac.alert('selected '+newAction);
			    }
			  });
			}

			// note that tagName may be empty
			function doNewTag(tagName) {
			  _awac.openPage('new-tag-markdown','edit_name.html',{name:tagName,show_markdown:true,title:'new tag'});
			}

			function doNewPage(itemId) {
				var initp = {};
				initp.show_markdown = true;
				if (itemId) {
					initp.show_item_id = true;
					initp.item_id = itemId;
				}
				initp.title='new page';
			  _awac.openPage('new-page','edit_name.html',initp);
			}

			function doAddComment() {
			  _awac.openPage('add-comment','edit_markdown.html',{include_name:false,markdown:'',title:'new comment'});
			}

			function doAddChildPage() {
			  _awac.openPage('edit-child-markdown','edit_name.html',{show_markdown:true,title:'new child page'});
			}

			function doAddChildTask() {
				_awac.openPage('edit-task-title','edit_name.html',{show_markdown:false,title:'new child task'});
			}

			function doEditItem() {
				_awac.openPage('edit-item','edit_item.html',{json:_fitem.json,item_id:_itemId,title:'edit '+_fitem.itemType.name.toLowerCase()});
			}

			function toggleTaskItem(itemJson) {
				  _awac.startRefresh();
				  console.log('toggleTaskItem() item='+JSON.stringify(itemJson));
					var item = new FItemRow(itemJson);
					var newVal = item.json.attrs_text.indexOf('done:true') == -1 ? 'true' : 'false';
					item.update_attr('done',newVal,function(json) {
						console.log('updated child Task item');
						refreshTaskList();
						_awac.endRefresh();
					});
			}

			function doToggleAttr(aname) {
				var attrsText = new Attrs(_fitem.json.attrs_text);
				var markdown = new Attrs(_fitem.json.markdown);
				if (attrsText.contains(aname) || markdown.contains(aname)) {
					var oldVal = attrsText.contains(aname) ? attrsText.getValue(aname) : markdown.getValue(aname);
					var newVal = oldVal.toLowerCase() == 'true' ? 'false' : 'true';
					_fitem.update_attr(aname,newVal,function(json) {
						if (attrsText.contains(aname)) {
							attrsText.update(aname,oldVal,newVal);
							_fitem.json.attrs_text = attrsText.getText();
						}
						else {
							markdown.update(aname,oldVal,newVal);
							_fitem.json.markdown = markdown.getText();
						}
						_fitem.json.modify = json.modify;
						renderItem(_fitem);
					});
				}
			}

			function showRecentItems() {
			  var initp = {};
			  initp.items_hdr = 'Recent Items !!!!';
			  initp.op = 'recent';
			  _awac.replacePage('recent','recent_items.html',initp,true);
			}

			function showCommentItems() {
			  var initp = {};
			  initp.items_hdr = 'Comments';
			  initp.op = 'comments';
			  initp.item_id = _fitem.json.item_id;
			  _awac.replacePage('recent','recent_items.html',initp,true);
			}

			var _linkedItems = [];

			function selectLinked(event,i) {
			  var id = _linkedItems[i].item_id;
			  FItem.historyPush(_awac,id);
			  _awac.replacePage('show','show_item.html',{'item_id':id},true);
			}

			function iconClick(event,i) {
			  console.log('iconClick() you clicked on an icon in row '+i+' e='+event);
				var item = _linkedItems[i]
				if (item.item_type_name == 'Task') {
					toggleTaskItem(item,'done');
			  	event.stopPropagation();
					return;
				}
			}

			function addLinkedItem(json,params) {
				console.log('addLinkedItem()');
				var div = document.getElementById(params.divId);
				console.log(' - '+params.divId+'.style.display='+div.style.display);
				if (div.style.display != 'block') {
					refreshTaskList();
					return;
				}

				var index = _linkedItems.length;
				_linkedItems[index] = json;

				var html = div.innerHTML;
				var i = html.indexOf('<tbody>');
				div.innerHTML = html.substring(0,i) + (new FItemRow(json)).getDiv(index,'selectLinked','iconClick') + html .substring(i+7);
			}

			function onGetLinkedItems(json,params) {
				console.log('onGetLinkedItems() params='+JSON.stringify(params));

			  var hdr = params.hdr;
			  var html = '<table style="width:100%;" class="mdl-data-table mdl-js-data-table"><tbody>';
			  var found = false;
			  for (var i=0;i<json.length;i++) {
					var index = _linkedItems.length;
					_linkedItems[index] = json[i];
			    html += (new FItemRow(json[i])).getDiv(index,'selectLinked','iconClick');
			    found = true;
			  }
				html += '</tbody></table>';
			  if (found) {
					var div = document.getElementById(params.divId);
					div.style.display = 'block';
			    div.innerHTML = '<div class="padded-container"><h4>'+hdr+'</h4></div>'+html;
				}
			}

			var _commentItems = null;

			function selectComment(i) {
			  var id = _commentItems[i].item_id;
			  FItem.historyPush(_awac,id);
			  _awac.replacePage('show','show_item.html',{'item_id':id},true);
			}

			function showHistory() {
			  _awac.replacePage('history','show_history.html',null,true);
			}

			function showNextPage(itemId) {
			  FItem.historyPush(_awac,itemId);
			  _awac.replacePage('show','show_item.html',{'item_id':itemId},true);
			}

			function newChildTask(itemJson) {
				console.log('newChildTask()');
				addLinkedItem(itemJson,{hdr:'Tasks',divId:'task-items-div'});
			}

			function refreshTaskList() {
				console.log('refreshTaskList()');
				FItem.getLinkedItems('Task','parent',_fitem.json.item_id,onGetLinkedItems,{hdr:'Tasks',divId:'task-items-div'});
			}

			function refreshCommentList() {
				FItem.getLinkedItems('Comment','parent',_fitem.json.item_id,onGetLinkedItems,{hdr:'Comments',divId:'comment-items-div'});
			}

			function showOptions(attr_name) {
			  _awac.alert('show options for attr '+attr_name);
			}

			function showUser(itemId) {
			  FItem.historyPush(_awac,itemId);
			  _awac.replacePage('show','show_item.html',{'item_id':itemId},true);
			}

			function appendEditControls(c) {
			  var html = '<span class="edit-control-span"><i class="material-icons">delete</i></span>' +
			    '<span class="edit-control-span"><i class="material-icons">edit</i></span>';
			  c.html(html);
			}

			function appendClearBoth(c) {
			    var d = newDiv();
			    d.css('clear','both');
			    //d.html('-clear-both-');
			    d.appendTo(c);
			}

			function newDiv(classes) {
			  var d = $(document.createElement('div'));
			  if (classes) d.addClass(classes);
			  return d;
			}

		  function renderItemHeader(fitem,iname,author) {
		      var titleDiv = $('#item-title-div');

			    titleDiv.html('');
			    newDiv('padded-container item-title').html(fitem.getTitleHTML()).appendTo(titleDiv);

			    var typesDiv = $('#item-types-div');
			    typesDiv.html('');
			    t = newDiv('left-content left');
			    newDiv('padded-container').css('display','flex').html('<div class="item-type"><i class="material-icons">'+iname+'</i></div>'+
			      '<div class="spacer"></div>' +
			      '<div>'+author+'</div>').appendTo(t);
			    t.appendTo(typesDiv);

			    appendClearBoth(typesDiv);
		  }

			function showPrevPage() {
			   var itemId = FItem.historyPop(_awac);
			   if (itemId)
			     _awac.replacePage('show','show_item.html',{'item_id':itemId},false);
			   else
  			   _awac.replacePage('root','app_login.html',null,false);
			}

      function renderItem(fitem) {
				var iname = fitem.getMDIcon();
				var a = fitem.getUserHTML();
				if (fitem.json.image_url) {
					$('#item-title-div').html(
						'<div class="img-container"><img src="'+fitem.json.image_url+'"/>'+
									'<div class="top"><div class="item-type-inner"><div class="item-type"><i class="material-icons">'+iname+'</i></div></div></div>'+
									'<div class="img-title"><div class="img-title-inner">'+fitem.getTitleHTML()+'</div></div>'+
						'</div>');
						$('#show-item-type').remove();
				}
				else {
					renderItemHeader(fitem,iname,a);
				}

				$('#show-item-markdown').html(fitem.getMarkdownHTML());
				$('#show-item-attrs').html(fitem.getAttrsHTML());
				$('#show-item-meta').html(fitem.getMetaHTML());
			}

			$(document).ready(function() {
			  _awac = new Awac('_awac');
			  var initp = _awac.getInitParam();
			  if (initp)
			    _itemId = initp.item_id;
			  else
			    _itemId = 'HomePage';

			  console.log('item-id='+_itemId);
				console.log('show_items.html dims = '+_awac.getDims());

			  var colors = _awac.getColors();
			  if (colors) $('#item-title').css('color',colors.primary_dark);

			  _awac.setOnPageClose(onPageClose);
			  _awac.setOnAction(onAction);
			  _awac.addNavDrawerItem({'label':'Sign out','action':'signout'});
			  _awac.addNavDrawerItem({'label':'Most recent','action':'recent'});
			  _awac.addNavDrawerItem({'label':'Show Comments','action':'comments'});
			  _awac.addNavDrawerItem({'label':'History','action':'history'});
			  _awac.unlockNavDrawer();

			  //_awac.setHomeItem({'label':'Back','icon':'arrow_back','action':'back'});
			  _awac.addActionBarItem({'icon':'add','label':'ADD','action':'add'});
			  _awac.addActionBarItem({'icon':'edit','label':'EDIT','action':'edit'});

			  _awac.setOnBackPressed(function() { onAction('back'); });

			  FItem.get(_itemId,function(fitem) {
					renderItem(fitem);
  				_fitem = fitem;

  				refreshTaskList();
					refreshCommentList();
			    FItem.getLinkedItems('Page','parent',_fitem.json.item_id,onGetLinkedItems,{hdr:'Child Pages',divId:'child-pages-div'});
					if (_fitem.itemType.name == 'Tag')
						FItem.getLinkedItems(null,'tag',_fitem.json.item_id,onGetLinkedItems,{hdr:'Tagged Items',divId:'tagged-items-div'});

					startPage();
			  });
			});
			</script>
	</head>
	<body>
		 <div id="toplevel" class="mdl-layout mdl-js-layout">

	   <div id="item-title-div">-item-title-goes-here-</div>
     <div id="item-types-div"></div>

		 <div id="show-item">
     	<div id="show-item-content">
      	<div class="padded-container">
        	<div id="show-item-markdown">-item-markup-goes-here-</div>
         	<div id="show-item-attrs">-item-attrs-go-here-</div>
       	</div>
     	</div>
		 	<div id="show-item-lists">
   	 		<div id="task-items-div" style="display:none;">-task-items-go-here-</div>
     		<div id="child-pages-div" style="display:none;">-child-pages-go-here-</div>
		 		<div id="tagged-items-div" style="display:none;">-tagged-items-go-here-</div>
     		<div id="comment-items-div" style="display:none;">-comment-items-go-here-</div>
	 		</div>
 		</div>

		 <div class="padded-container">
		   <div id="show-item-meta">-item-metadata-go-here-</div>
		 </div>

		 <div id="test-area">
			 <!--div id="my-box" class="box"></div-->
		 </div>

     <div class="show-item-footer padded-container">
        <a href="javascript:onAction('edit');">EDIT</a> |  <a href="javascript:onAction('back');">BACK</a> |  <a href="javascript:onAction('test');">TEST</a>
     </div>

	 </div> <!-- toplevel -->
	</body>
</html>
